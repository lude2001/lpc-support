# LPC 语言支持扩展

这是一个为 LPC (LP MUD Creation Language) 提供全面语言支持的 VSCode 扩展，专为 FluffOS MUD 开发环境设计。

## 主要特性

### 1. 智能代码分析与诊断

- **变量分析**
  - 未使用变量检测
  - 全局/局部变量区分
  - 数组和映射变量声明检测
  - foreach 语句智能分析
  - 变量作用域追踪

- **函数分析**
  - apply 函数自动识别
  - 函数定义和调用检测
  - 跨文件函数追踪
  - 继承关系分析

- **语法检查**
  - 对象访问语法验证
  - 字符串语法检查（含 @TEXT/@LONG 支持）
  - 文件命名规范检查
  - 实时错误提示

### 2. 智能编码辅助

- **代码补全**
  - 内置函数（efun）智能提示
  - 类型和修饰符补全
  - 上下文感知的代码建议
  - 预处理指令补全

- **代码导航**
  - 函数定义跳转
  - 变量定义查找
  - 继承关系导航
  - 宏定义跳转

### 3. 强大的宏支持

- **宏定义管理**
  - 自动扫描和索引
  - 实时文件监控
  - 跨文件宏定义追踪
  - 宏定义值解析

- **智能提示**
  - 宏定义补全
  - 悬停信息显示
  - 注释文档支持
  - 快速导航

### 4. 代码优化工具

- **快速修复**
  - 未使用变量处理
  - 全局变量声明转换
  - 语法错误修正建议

- **代码格式化**
  - 智能缩进对齐
  - 括号匹配格式化
  - 多行字符串格式化
  - case 语句智能处理

### 5. FluffOS 服务器集成

- **服务器管理**
  - 多服务器配置
  - 快速切换服务器
  - 服务器状态监控

- **编译部署**
  - 一键编译推送
  - 编译错误反馈
  - 实时同步更新

## 配置选项

### 基础配置
- `lpc.includePath`: 宏定义包含目录路径
- `lpc.editor.commentLine`: 行注释快捷键（默认: Ctrl+/）
- `lpc.editor.blockComment`: 块注释快捷键（默认: Shift+Alt+A）

### 服务器配置
- 服务器 URL 配置
- 编译选项设置
- 默认服务器选择

## 命令列表

### 代码分析
- `lpc-support.checkUnusedVariables`: 检查未使用变量
- `lpc.showVariables`: 显示所有变量
- `lpc.scanFolder`: 扫描文件夹

### 服务器管理
- `lpc.addServer`: 添加服务器
- `lpc.selectServer`: 选择服务器
- `lpc.removeServer`: 移除服务器
- `lpc.manageServers`: 服务器管理
- `lpc.compileFile`: 编译当前文件

### 宏定义工具
- `lpc.showMacros`: 显示宏定义列表
- `lpc.configureMacroPath`: 配置宏目录

## 系统架构

### 核心组件

1. **诊断引擎 (diagnostics.ts)**
   - 实时代码分析
   - 错误检测和报告
   - 变量和函数追踪
   - 语法规则验证

2. **宏管理器 (macroManager.ts)**
   - 宏定义扫描和索引
   - 文件监控和更新
   - 宏定义解析和验证
   - 文档注释处理

3. **代码操作处理器 (codeActions.ts)**
   - 快速修复生成
   - 代码重构支持
   - 智能建议提供
   - 修改方案实现

4. **智能补全引擎 (completionProvider.ts)**
   - 上下文感知补全
   - 函数参数提示
   - 代码片段生成
   - 智能类型推断

5. **定义提供器 (definitionProvider.ts)**
   - 符号定义跳转
   - 继承关系分析
   - 跨文件导航
   - 宏定义解析

6. **编译器接口 (compiler.ts)**
   - 服务器通信
   - 编译请求处理
   - 错误信息解析
   - 实时状态反馈

7. **配置管理器 (config.ts)**
   - 用户配置管理
   - 服务器配置
   - 持久化存储
   - 设置验证

### 扩展点

1. **语言服务**
   - 语法高亮
   - 代码折叠
   - 括号匹配
   - 注释处理

2. **编辑器增强**
   - 智能缩进
   - 自动完成
   - 代码片段
   - 快捷操作

## 开发指南

### 环境设置

1. **前置需求**
   - Node.js
   - VS Code
   - TypeScript
   - VS Code 扩展开发工具

2. **构建步骤**
   ```bash
   npm install
   npm run compile
   ```

### 调试说明

1. **启动调试**
   - 按 F5 启动调试实例
   - 使用调试控制台查看日志
   - 设置断点进行调试

2. **测试**
   - 运行单元测试：`npm test`
   - 运行集成测试：`npm run test:integration`

### 发布流程

1. **版本管理**
   - 更新版本号
   - 更新更新日志
   - 打包扩展

2. **发布检查**
   - 代码质量检查
   - 功能测试验证
   - 文档更新确认

## 贡献指南

1. **提交规范**
   - 遵循 Git 提交规范
   - 包含清晰的提交信息
   - 确保代码格式化

2. **代码规范**
   - 遵循 TypeScript 规范
   - 添加必要的注释
   - 保持代码简洁清晰

3. **文档维护**
   - 更新功能文档
   - 添加代码注释
   - 保持文档同步

## 许可证

MIT License - 详见 LICENSE 文件
