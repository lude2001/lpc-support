# LPC 语言支持扩展

这是一个为 LPC (LP MUD Creation Language) 提供语言支持的 VSCode 扩展。

## 功能特性

### 1. 代码诊断

- 变量使用分析
  - 检测未使用的变量
  - 区分全局变量和局部变量
  - 支持数组声明检测
- 函数分析
  - apply 函数检测
  - 函数定义检测
- 对象访问语法检查
- 数字字面量检查
- 字符串语法检查
- 文件命名规范检查

### 2. 代码补全

- 内置函数补全
  - 数组相关函数
  - 缓冲区相关函数
  - 调用相关函数
  - 数据库相关函数
  - 文件系统相关函数
  - 浮点运算相关函数
  - 类相关函数
  - 在线编辑相关函数
- 智能提示
  - 函数参数提示
  - 函数返回值提示
  - 函数用法说明

### 3. 宏定义支持

- 宏定义扫描
- 宏补全提示
- 宏定义跳转
- 宏定义悬停信息
- 支持配置宏定义目录

### 4. 代码操作

- 快速修复建议
  - 删除未使用变量
  - 将变量标记为全局变量
- 代码格式化
  - 智能缩进
  - 大括号对齐
  - case 语句缩进
- 代码注释
  - 支持行注释 (Ctrl+/)
  - 支持块注释 (Shift+Alt+A)
  - 自动检测注释风格

### 5. 服务器管理

- 添加/删除服务器
- 编辑服务器配置
- 切换活动服务器
- 编译文件到服务器

## 配置项

- `lpc.includePath`: 配置宏定义包含目录的路径
- `lpc.editor.commentLine`: 配置行注释快捷键 (默认: Ctrl+/)
- `lpc.editor.blockComment`: 配置块注释快捷键 (默认: Shift+Alt+A)

## 命令列表

- `lpc-support.checkUnusedVariables`: 检查未使用的变量
- `lpc.showVariables`: 显示所有 LPC 变量
- `lpc.scanFolder`: 扫描文件夹中未使用的变量
- `lpc.addServer`: 添加 FluffOS 服务器
- `lpc.selectServer`: 选择活动服务器
- `lpc.removeServer`: 删除服务器
- `lpc.compileFile`: 编译 LPC 文件
- `lpc.manageServers`: 管理编译服务器
- `lpc.showMacros`: 显示所有宏定义
- `lpc.configureMacroPath`: 配置宏定义目录

## 项目结构

### 目录结构

```
lpc-support/
├── src/                    # TypeScript 源代码目录
│   ├── extension.ts        # 扩展入口文件，负责激活扩展和注册各种提供者
│   ├── diagnostics.ts      # 代码诊断实现，包含语法检查和错误提示
│   ├── macroManager.ts     # 宏定义管理器，处理宏的扫描、存储和查询
│   ├── codeActions.ts      # 代码操作提供者，实现快速修复功能
│   ├── completionProvider.ts # 代码补全提供者，提供智能提示
│   ├── definitionProvider.ts # 定义跳转提供者，处理符号跳转
│   ├── typeChecker.ts      # 类型检查器，进行类型兼容性验证
│   ├── compiler.ts         # 编译器接口，处理与 MUD 服务器的编译交互
│   ├── config.ts          # 配置管理器，处理扩展配置和服务器配置
│   ├── efunDocs.ts        # 内置函数文档，提供函数说明和用法
│   ├── workspaceSymbolProvider.ts  # 工作区符号提供者，支持全局符号搜索
│   └── documentSymbolProvider.ts   # 文档符号提供者，提供文件内符号列表
├── out/                    # 编译后的 JavaScript 代码目录
│   └── *.js               # 编译后的各个模块文件
├── syntaxes/              # 语法定义目录
│   └── lpc.tmLanguage.json # LPC 语言语法规则定义
└── snippets/              # 代码片段目录
    └── lpc.json           # LPC 代码片段定义
```

### 核心模块说明

1. `extension.ts`
   - 扩展的入口点
   - 注册各种语言功能提供者
   - 初始化扩展环境
   - 注册命令处理器

2. `diagnostics.ts`
   - 实现代码诊断功能
   - 检测未使用的变量
   - 检查语法错误
   - 分析函数调用
   - 提供实时诊断反馈

3. `macroManager.ts`
   - 扫描和解析宏定义文件
   - 维护宏定义的映射关系
   - 处理宏的注释和文档
   - 提供宏定义查询接口

4. `codeActions.ts`
   - 提供代码快速修复建议
   - 实现变量相关的代码操作
   - 处理代码重构建议
   - 生成代码修改方案

5. `completionProvider.ts`
   - 提供智能代码补全
   - 实现函数补全
   - 提供参数提示
   - 生成代码片段

6. `definitionProvider.ts`
   - 处理符号定义跳转
   - 解析继承关系
   - 处理宏定义跳转
   - 支持跨文件导航

7. `typeChecker.ts`
   - 实现类型检查系统
   - 验证类型兼容性
   - 提供类型推断
   - 检查类型错误

8. `compiler.ts`
   - 与 MUD 服务器通信
   - 处理文件编译请求
   - 规范化文件路径
   - 管理编译错误

9. `config.ts`
   - 管理扩展配置
   - 处理服务器配置
   - 保存和加载设置
   - 提供配置接口

10. `efunDocs.ts`
    - 存储内置函数文档
    - 提供函数说明
    - 包含参数说明
    - 提供示例代码

11. `workspaceSymbolProvider.ts`
    - 支持工作区符号搜索
    - 索引全局符号
    - 处理符号查询
    - 提供符号列表

12. `documentSymbolProvider.ts`
    - 解析文档符号
    - 提供文件大纲
    - 支持符号导航
    - 维护符号层次结构

### 辅助文件说明

1. `syntaxes/lpc.tmLanguage.json`
   - 定义 LPC 语言语法规则
   - 配置语法高亮
   - 设置代码分区
   - 指定关键字匹配

2. `snippets/lpc.json`
   - 定义常用代码片段
   - 提供快速输入模板
   - 支持变量占位符
   - 包含代码示例

## 开发说明

### 主要类

1. `LPCDiagnostics`: 负责代码诊断
   - 变量使用分析
   - 函数分析
   - 语法检查

2. `MacroManager`: 管理宏定义
   - 扫描宏定义文件
   - 提供宏定义信息
   - 处理宏定义跳转

3. `LPCCodeActionProvider`: 提供代码操作
   - 处理未使用变量
   - 提供快速修复建议

4. `LPCCompletionItemProvider`: 提供代码补全
   - 内置函数补全
   - 智能提示

5. `LPCDefinitionProvider`: 提供定义跳转
   - 处理宏定义跳转
   - 处理继承关系跳转

### 扩展点

- `languages`: 定义 LPC 语言支持
- `grammars`: 定义语法高亮
- `snippets`: 提供代码片段
- `commands`: 注册命令
- `menus`: 定义上下文菜单

## 贡献指南

1. Fork 项目
2. 创建特性分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 许可证

[待补充]

## 相关资源

- [LPC 语言文档](https://mud.wiki/LPC)
- [FluffOS 文档](https://www.fluffos.info)

## 常见问题

[待补充]

## 更新日志

### 0.0.1
- 初始版本发布
- 基础功能实现
